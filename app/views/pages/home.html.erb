<% content_for :page_class, "berthier-home" %>

<!-- Flash messages -->
<% if flash[:notice] %>
  <div class="flash flash--notice"><%= flash[:notice] %></div>
<% end %>
<% if flash[:alert] %>
  <div class="flash flash--alert"><%= flash[:alert] %></div>
<% end %>

<!-- Header / Navigation -->
<%= render "shared/navbar" %>

<main class="berthier-home">
  <!-- Hero Section avec sÃ©lecteur de cravates -->
  <section class="hero">
    <div class="hero__grid">
      <div class="hero__copy">
        <h1 class="hero__title">LA CRAVATE<br>QUI ASSUME SES<br>CONTRADICTIONS.</h1>
        <p class="hero__subtitle">Pour ceux qui portent le costume sans y croire.</p>

        <!-- Proposition de valeur -->
        <div class="hero__values">
          <span class="hero__value">ğŸŒ± 100% lin bio franÃ§ais</span>
          <span class="hero__value">ğŸ¤ Confection solidaire ESS</span>
          <span class="hero__value">âœŠ 10% reversÃ©s</span>
        </div>

        <div class="hero__cta">
          <%= link_to "DÃ©couvrir la collection", cravates_path, class: "btn btn--large" %>
        </div>
      </div>
      <div class="hero__img-container">
        <!-- Image principale de Berthier - cliquable -->
        <div class="hero__berthier-showcase" id="berthierShowcase">
          <% @hero_cravates.each_with_index do |cravate, index| %>
            <%= image_tag cravate[:image],
                alt: "Berthier porte #{cravate[:name]}",
                class: "hero__berthier-img #{index == 0 ? 'active' : ''}",
                data: { cravate_index: index } %>
          <% end %>
        </div>

        <!-- SÃ©lecteur de cravates - pastilles -->
        <div class="hero__cravate-selector">
          <span class="selector__label">17 cravates disponibles</span>
          <div class="selector__options">
            <% @hero_cravates.each_with_index do |cravate, index| %>
              <button class="selector__dot <%= 'active' if index == 0 %>"
                      data-cravate-index="<%= index %>"
                      style="--swatch-color: <%= cravate[:swatch_color] %>"
                      title="<%= cravate[:name] %>">
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bandeau reassurance -->
  <section class="reassurance-bar">
    <div class="container">
      <div class="reassurance__grid">
        <div class="reassurance__item">
          <span class="reassurance__icon">ğŸ‡«ğŸ‡·</span>
          <span class="reassurance__text">FabriquÃ© en France</span>
        </div>
        <div class="reassurance__item">
          <span class="reassurance__icon">ğŸ“¦</span>
          <span class="reassurance__text">Livraison offerte dÃ¨s 2 cravates</span>
        </div>
        <div class="reassurance__item">
          <span class="reassurance__icon">â†©ï¸</span>
          <span class="reassurance__text">Retours gratuits 30 jours</span>
        </div>
        <div class="reassurance__item">
          <span class="reassurance__icon">ğŸ’³</span>
          <span class="reassurance__text">Paiement sÃ©curisÃ©</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Piliers / Valeurs - Cards entiÃ¨rement cliquables -->
  <section id="valeurs" class="values-hero">
    <div class="container">
      <div class="values-hero__intro">
        <h2 class="values-hero__title">TROIS ENGAGEMENTS.<br>PAS DE COMPROMIS.</h2>
        <p class="values-hero__subtitle">La cravate qui assume ses convictions, mÃªme si Ã§a froisse quelques chemises.</p>
      </div>
      <div class="values-grid">
        <!-- Card Ã‰cologique - entiÃ¨rement cliquable -->
        <%= link_to engagement_ecologique_path, class: "value-card value-card--1" do %>
          <div class="value-card__image">
            <%= image_tag "bloc_solidaire/ficus.png", alt: "Plante de bureau fanÃ©e" %>
          </div>
          <div class="value-card__content">
            <div class="value-card__header">
              <span class="value-card__ref">[DOSSIER ECO-2026]</span>
            </div>
            <h3 class="value-card__title">Ã‰COLOGIQUE</h3>
            <p class="value-card__description">100% Lin bio sourcÃ© en France. Une matiÃ¨re qui respire, contrairement Ã  votre carriÃ¨re.</p>
            <div class="value-card__cta">
              <span class="value-card__link">En savoir plus â†’</span>
            </div>
          </div>
        <% end %>

        <!-- Card FÃ©ministe - entiÃ¨rement cliquable -->
        <%= link_to engagement_feministe_path, class: "value-card value-card--2" do %>
          <div class="value-card__image">
            <%= image_tag "bloc_solidaire/rouge_a_levre.png", alt: "Berthier avec rouge Ã  lÃ¨vres" %>
          </div>
          <div class="value-card__content">
            <div class="value-card__header">
              <span class="value-card__ref">[DOSSIER FEM-1994]</span>
            </div>
            <h3 class="value-card__title">FÃ‰MINISTE</h3>
            <p class="value-card__description">10% des bÃ©nÃ©fices reversÃ©s. Parce que le patriarcat de bureau est un concept dÃ©passÃ©, mÃªme pour Berthier.</p>
            <div class="value-card__cta">
              <span class="value-card__link">En savoir plus â†’</span>
            </div>
          </div>
        <% end %>

        <!-- Card Solidaire - entiÃ¨rement cliquable -->
        <%= link_to engagement_solidaire_path, class: "value-card value-card--3" do %>
          <div class="value-card__image">
            <%= image_tag "bloc_solidaire/pot-de-depart.png", alt: "Pot de dÃ©part ThÃ©rÃ¨se" %>
          </div>
          <div class="value-card__content">
            <div class="value-card__header">
              <span class="value-card__ref">[DOSSIER ESS-FR]</span>
            </div>
            <h3 class="value-card__title">SOLIDAIRE</h3>
            <p class="value-card__description">ConfectionnÃ©e par des entreprises de l'ESS. On soutient l'humain, le vrai, celui des ateliers.</p>
            <div class="value-card__cta">
              <span class="value-card__link">En savoir plus â†’</span>
            </div>
          </div>
        <% end %>
      </div>
      <div class="values-banner">
        <div class="values-banner__stat">
          <span class="values-banner__number">10%</span>
          <span class="values-banner__label">de chaque vente reversÃ©s</span>
        </div>
        <div class="values-banner__stat">
          <span class="values-banner__number">100%</span>
          <span class="values-banner__label">Lin bio franÃ§ais</span>
        </div>
        <div class="values-banner__stat">
          <span class="values-banner__number">0</span>
          <span class="values-banner__label">IntermÃ©diaire inutile</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Collection de produits -->
  <section id="produit" class="products">
    <div class="container">
      <h2 class="section-title">LE CATALOGUE ADMINISTRATIF</h2>
      <p class="section-subtitle">Dix-sept cravates. Pas une de plus. On ne fait pas dans l'excÃ¨s.</p>

      <div class="products__grid">
        <% @cravates.each do |cravate| %>
          <%= link_to cravate_path(cravate), class: "product-card" do %>
            <div class="product-card__badge">
              <%= cravate.material %>
            </div>
            <div class="product-card__img">
              <% if cravate.photos.attached? %>
                <%= image_tag cravate.photos.first, alt: cravate.name %>
              <% else %>
                <div class="product-img-placeholder">
                  [IMAGE <%= cravate.reference %>]
                </div>
              <% end %>
            </div>
            <div class="product-card__content">
              <span class="product-card__ref"><%= cravate.reference %></span>
              <h3 class="product-card__name"><%= cravate.name %></h3>
              <p class="product-card__description"><%= truncate(cravate.description, length: 100) %></p>
              <div class="product-card__footer">
                <span class="product-card__price"><%= number_to_currency(cravate.price, unit: "â‚¬", format: "%n%u") %></span>
                <% if cravate.available? %>
                  <span class="btn btn--small">Voir</span>
                <% else %>
                  <span class="product-card__stock">BientÃ´t disponible</span>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>

  <!-- TÃ©moignages / Preuves sociales -->
  <section class="testimonials">
    <div class="container">
      <h2 class="section-title">CE QU'ILS DISENT DE BERTHIER</h2>
      <p class="section-subtitle">Des vrais gens. Des vraies cravates. Des vraies rÃ©unions.</p>

      <div class="testimonials__grid">
        <article class="testimonial">
          <div class="testimonial__stars">â˜…â˜…â˜…â˜…â˜…</div>
          <blockquote class="testimonial__quote">
            Â« J'ai portÃ© ma Berthier Ã  mon entretien annuel. Mon manager a remarquÃ© la cravate avant mes rÃ©sultats. Mission accomplie. Â»
          </blockquote>
          <div class="testimonial__author">
            <span class="testimonial__name">Marc D.</span>
            <span class="testimonial__role">ContrÃ´leur de gestion, Lyon</span>
          </div>
          <span class="testimonial__product">â€” La RÃ©union Inutile (bordeaux)</span>
        </article>

        <article class="testimonial">
          <div class="testimonial__stars">â˜…â˜…â˜…â˜…â˜…</div>
          <blockquote class="testimonial__quote">
            Â« Le lin se froisse ? Oui. Comme ma patience en open space. C'est cohÃ©rent. Â»
          </blockquote>
          <div class="testimonial__author">
            <span class="testimonial__name">Sophie L.</span>
            <span class="testimonial__role">Directrice RH, Paris</span>
          </div>
          <span class="testimonial__product">â€” Le Pot de DÃ©part (vert sapin)</span>
        </article>

        <article class="testimonial">
          <div class="testimonial__stars">â˜…â˜…â˜…â˜…â˜…</div>
          <blockquote class="testimonial__quote">
            Â« Je l'ai offerte Ã  mon pÃ¨re pour sa retraite. Il a pleurÃ©. Puis il a demandÃ© s'il pouvait la porter au pot de dÃ©part. Â»
          </blockquote>
          <div class="testimonial__author">
            <span class="testimonial__name">Thomas B.</span>
            <span class="testimonial__role">DÃ©veloppeur, Nantes</span>
          </div>
          <span class="testimonial__product">â€” La Note de Frais (bleu marine)</span>
        </article>
      </div>
    </div>
  </section>

  <!-- Bio Berthier -->
  <section id="manifeste" class="bio">
    <div class="container">
      <div class="bio__content">
        <h2 class="section-title">QUI EST BERTHIER ?</h2>
        <blockquote class="bio__quote">
          "J'ai passÃ© 22 ans dans un bureau. J'ai vu des gens partir, des plantes mourir, des projets s'enliser. La seule chose qui tenait, c'Ã©tait ma cravate."
        </blockquote>
        <p class="bio__text">
          Berthier, c'est ce collÃ¨gue qu'on a tous eu. Celui qui arrive Ã  8h47, qui dit bonjour Ã  tout le monde, qui connaÃ®t le prÃ©nom de la dame de la compta. Celui qui porte une cravate tous les jours â€” pas par conviction, mais par habitude. Et puis un jour, il s'est demandÃ© : puisque je dois la porter, autant qu'elle dise quelque chose.
        </p>
        <p class="bio__signature">â€” Berthier, Service ComptabilitÃ©, 1994-2016</p>
      </div>
    </div>
  </section>

  <!-- Partenaires / Labels -->
  <section class="partners">
    <div class="container">
      <p class="partners__title">Ils nous font confiance</p>
      <div class="partners__grid">
        <div class="partner__item">
          <span class="partner__logo">ğŸŒ±</span>
          <span class="partner__name">Lin de France</span>
        </div>
        <div class="partner__item">
          <span class="partner__logo">ğŸ¤</span>
          <span class="partner__name">ESS France</span>
        </div>
        <div class="partner__item">
          <span class="partner__logo">âœŠ</span>
          <span class="partner__name">Force Femmes</span>
        </div>
        <div class="partner__item">
          <span class="partner__logo">ğŸ­</span>
          <span class="partner__name">Made in Grand Est</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Newsletter -->
  <section id="newsletter" class="newsletter">
    <div class="container">
      <div class="newsletter__box">
        <h2>LA NOTE DE SERVICE</h2>
        <p>NouveautÃ©s, coulisses, et rÃ©flexions sur la vie de bureau. Pas de spam, promis â€” on a dÃ©jÃ  assez de mails comme Ã§a.</p>
        <%= form_with url: "#", method: :post, local: true, class: "newsletter__form" do |form| %>
          <%= form.email_field :email,
              placeholder: "votre@email.fr",
              required: true,
              class: "newsletter__input" %>
          <%= form.submit "S'inscrire", class: "btn" %>
        <% end %>
        <p class="newsletter__note">DÃ©sinscription en un clic. On n'est pas du genre Ã  insister.</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer__grid">
        <div class="footer__brand">
          <strong>LA CRAVATE DE BERTHIER</strong>
          <p class="footer__tagline">L'Ã©lÃ©gance de la dÃ©construction</p>
          <div class="footer__social">
            <a href="#" class="footer__social-link" title="Instagram">ğŸ“¸</a>
            <a href="#" class="footer__social-link" title="LinkedIn">ğŸ’¼</a>
          </div>
        </div>

        <div class="footer__links">
          <h4>Boutique</h4>
          <ul>
            <li><%= link_to "Catalogue", cravates_path %></li>
            <li><a href="#valeurs">Nos engagements</a></li>
            <li><%= link_to "FAQ", faq_path rescue "#" %></li>
          </ul>
        </div>

        <div class="footer__links">
          <h4>Informations</h4>
          <ul>
            <li><%= link_to "Ã€ propos", about_path rescue "#" %></li>
            <li><%= link_to "Contact", contact_path rescue "#" %></li>
            <li><%= link_to "Livraison & Retours", shipping_path rescue "#" %></li>
          </ul>
        </div>

        <div class="footer__links">
          <h4>LÃ©gal</h4>
          <ul>
            <li><%= link_to "CGV", cgv_path rescue "#" %></li>
            <li><%= link_to "Mentions lÃ©gales", mentions_legales_path rescue "#" %></li>
            <li><%= link_to "Politique de confidentialitÃ©", privacy_path rescue "#" %></li>
          </ul>
        </div>
      </div>

      <div class="footer__bottom">
        <p>Â© 2026 La Cravate de Berthier â€” Tous droits rÃ©servÃ©s</p>
        <p class="footer__credit">Fait avec ğŸ¤ et un peu d'ironie Ã  Nancy</p>
      </div>
    </div>
  </footer>
</main>

<script>
// Menu mobile toggle
document.querySelector('.mobile-menu-toggle')?.addEventListener('click', function() {
  document.querySelector('.main-nav__links').classList.toggle('active');
  this.classList.toggle('active');
});

// SÃ©lecteur de cravates avec auto-dÃ©filement initial (3 changements, 2 secondes)
document.addEventListener('DOMContentLoaded', function() {
  const images = document.querySelectorAll('.hero__berthier-img');
  const dots = document.querySelectorAll('.selector__dot');
  const showcase = document.getElementById('berthierShowcase');
  let currentIndex = 0;
  let autoPlayInterval = null;
  let autoPlayCount = 0;
  let userHasInteracted = false;

  function switchCravate(index) {
    images.forEach(img => img.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));

    images[index].classList.add('active');
    dots[index].classList.add('active');

    currentIndex = index;
  }

  function stopAutoPlay() {
    if (autoPlayInterval) {
      clearInterval(autoPlayInterval);
      autoPlayInterval = null;
    }
  }

  function startAutoPlay() {
    autoPlayInterval = setInterval(() => {
      autoPlayCount++;
      const nextIndex = (currentIndex + 1) % images.length;
      switchCravate(nextIndex);

      if (autoPlayCount >= 3) {
        stopAutoPlay();
      }
    }, 2000);
  }

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      userHasInteracted = true;
      stopAutoPlay();
      switchCravate(index);
    });
  });

  showcase?.addEventListener('click', function() {
    userHasInteracted = true;
    stopAutoPlay();
    const nextIndex = (currentIndex + 1) % images.length;
    switchCravate(nextIndex);
  });

  showcase?.addEventListener('mouseenter', () => {
    if (!userHasInteracted) {
      stopAutoPlay();
    }
  });

  showcase?.addEventListener('mouseleave', () => {
    if (!userHasInteracted && autoPlayCount < 3) {
      startAutoPlay();
    }
  });

  setTimeout(() => {
    if (!userHasInteracted) {
      startAutoPlay();
    }
  }, 800);
});
</script>
